<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户修改密码设置</title>
   
   <link href="${s.base}/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/css/bootstrapValidator.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="${s.base}/js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="${s.base}/js/jquery.form.js"></script>
    <script type="text/javascript" src="${s.base}/js/oc.min.js"></script> 
    <script type="text/javascript" src="${s.base}/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="${s.base}/js/bootstrapValidator.min.js"></script>
    <link rel="icon" type="image/png" href="${s.base}/i/ico.png" sizes="16x16">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href="${s.base}/css/style.css" rel="stylesheet" type="text/css"/>

    <style>
        .main {
            position: absolute;
            z-index: 2;
            width: 520px;
            height: 300px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 4px;
            position: absolute;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .title {
            text-align: center;
            position: absolute;
            left: 39%;
            top: 23%;
        }

        .container {
            margin-top: 10%;
            z-index: 1;
        }

        .form-bg {
            background: #00b4ef;

        }

        #register {
            margin-left: 20px;
        }

        #alertDiv {
            display: none;
        }
        .mg10px{
            margin-top:10px!important;
        }
        .mgt20px{
            margin-top:20px!important;
            padding-right:80px;
        }
        .inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
        .inputfile + label {
            font-size: 1.00em;
            font-weight: 600;
            display: inline-block;
            border-radius: 5px;
        }
        .inputfile + label {
            cursor: pointer; /* "hand" cursor */
        }
        .pl30px{
            padding-left: 30px;
        }
         .lf15px{
            left: 15px;
        }
    </style>
</head>

<body>
<#include "common/header.html" />
<#include "./nav.html" />
<div class="content">
        <div class="col-sm-offset-2 col-sm-6" style="padding-top:40px">
            <form class="form-horizontal" method="post" id="profileForm" role="form" enctype="multipart/form-data">
                <div style="border-bottom: 1px solid #ccc;">
                <h1 style="text-align: center;color:#999;font-family:'microsoft yahei';">个人信息修改</h1>
                </div>
              
                <div  style="width:150px;margin:10px auto;">
                    <div style="width:100%;height:150px;background-color:blue; border-radius:75px;overflow: hidden;">
                        <img src=${Session["login_user"].icon} id="image" style="height: 100%;width: 100%;" alt="">
                    </div>
                    <center style="margin-top:20px;">
                    <input type="file" name="file" id="file" class="inputfile" 
                    accept="image/jpeg,image/jpg,image/png"/>
                    <label for="file" class="btn btn-default btn-xs">上传头像</label>
                    </center>
                </div>

                <fieldset disabled>
                    <div class="form-group has-feedback " style="margin-top: 30px;">
                        <label for="username" class="col-sm-1 control-label">账号</label>
                       <div class="col-sm-10">
                        <input type="text " class="form-control disabled pl30px" name="name" id="username" value="${user.name!}" />
                        <span class="glyphicon glyphicon-user form-control-feedback lf15px" ></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="role" class="col-sm-2 control-label">角色</label>
                        <div class="col-sm-10">
                        <input type="option" class="form-control disabled pl30px" value="任务管理员" id="role">
                         <span class="glyphicon glyphicon-user form-control-feedback lf15px"></span>
                        </div>
                    </div>
                </fieldset> 
                                   
                <div class="form-group">
                     <label for="nickname" class="col-sm-2 control-label">昵称</label>
                    <div class="col-sm-10">
                    <!-- 此处只能存放45(varchar)/2个汉字。 -->
                    <input type="text" class="form-control pl30px" name="nickname" id="nickname" value="${user.nickname!}" maxlength="20">
                    <span class="glyphicon glyphicon-user form-control-feedback lf15px" ></span>
                    </div>
                </div>
                
                <div class="form-group">
                     <label for="worknumber" class="col-sm-2 control-label">工号</label>
                    <div class="col-sm-10">
                    <!-- 此处只能存放45(varchar)/2个汉字。 -->
                    <input type="text" class="form-control pl30px" name="worknumber" id="worknumber" value="${user.worknumber!}" maxlength="20">
                    <span class="glyphicon glyphicon-user form-control-feedback lf15px" ></span>
                    </div>
                </div>
                
                <div class="form-group">
                     <label for="email" class="col-sm-2 control-label">邮箱</label>
                    <div class="col-sm-10 ">
                    <input type="email" class="form-control pl30px" id="email" name="email" value="${user.email!}">
                    <span class="glyphicon glyphicon-envelope form-control-feedback lf15px"></span>
                    </div>
                </div>

                <div class="form-group">
                     <label for="phone1" class="col-sm-2 control-label">电话1</label>
                    <div class="col-sm-10">
                    <input type="text" class="form-control pl30px" id="phonenumber1" name="phoneone" value="${user.phoneone!}">
                     <span class="glyphicon glyphicon-phone form-control-feedback lf15px" ></span>
                    </div>
                </div>
                
                <div class="form-group">
                     <label for="phone2" class="col-sm-2 control-label">电话2</label>
                    <div class="col-sm-10">   
                    <input type="text" class="form-control pl30px" id="phonenumber2" name="phonetwo" value="${user.phonetwo!}">
                     <span class="glyphicon glyphicon-phone-alt form-control-feedback lf15px" ></span>
                    </div>
                </div>

                <div class="form-group">
	                <label for="description" class="col-sm-2 control-label" >个人简介</label>
	                <div class="col-sm-10">
	                <!-- 此处只能存放45(varchar)/2个汉字。 -->
	                <input type="textarea"class="form-control pl30px" rows="4" maxlength="20" id="description" name="description" value="${user.description!}"></input>
	                 <span class="glyphicon glyphicon-pencil form-control-feedback lf15px" ></span>
	                </div>
                </div>

                <div class="form-group mgt20px pull-right">
                    <button type="button" class="btn btn-default btn-primary" id="modify" style="margin-left:20px">修改</button>
                    <button type="reset" class="btn btn-default" id="restart" >重置</button>
                </div>                      
            </form>
    </div>

</div>
<div class="modal" id="_ocDialogModal" tabindex="-1" aria-hidden="true">
	    <div class="modal_wapper small">
	        <div class="modal-dialog w-4" >
	            <div class="modal-content">
	                <div class="modal-header">
	                    <div class="modal-title f-16" >提示信息</div>
	                </div>
	                <div class="modal-body">
	                    <div><span class="color-oc f-16 oc-content" id="resText">修改成功！</span></div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
<script type="text/javascript">
    // $("#modify").click(function() {
    //     var password = $("#newpassword").val();
    //     var passwordensure = $("#newpasswordensure").val();
    //     if (password != passwordensure) {
    //         // alert("1234");
    //         showAlert('新密码和确认新密码不一致！');
    //     } else {
    //         $.ajax({
    //             url: '../admin/profileEdit.action',
    //             type: 'POST',
    //             async: true,
    //             data:$("#profileForm").serialize(),
    //             timeout: 5000,
    //             dataType: 'json',
    //             success: function(result) {
    //                 //alert(JSON.stringify(result));
    //                 if (result.errcode==0)
    //                 {
    //                     showAlert(result.message);
    //                     window.location.href = "../index.action";
    //                 } else {
    //                     showAlert(result.message);
    //                 }
    //             }
    //         });
    //     }
    // });
    function showUserList() {
        window.location.reload();
    }

    //初始化验证规则函数
     $("#modify").on("click", function(){
         //获取表单对象
        var bootstrapValidator = $('#profileForm').data('bootstrapValidator');
        //手动触发验证
        bootstrapValidator.validate();
        if(bootstrapValidator.isValid()){
            // 验证成功可以直接提交ajax请求
          /*   $.ajax({
                   url: '${s.base}/admin/profileEdit.action',
                   type: 'POST',
                   data:$("#profileForm").serialize(),
                   dataType: 'json',
                   success: function(result) {	                    
                   	     $("#resText").text(result.message);
                      	 Modal.show('_ocDialogModal');
                   }
            }); */
        	var option={
           		 type: 'POST',
           		 url: '${s.base}/admin/doprofileEdit.action',
           		 dataType: 'json',
           		 data:$("#profileForm").serialize(),
           		 success: function(result) {	                    
                  	     $("#resText").text(result.message);
                     	 Modal.show('_ocDialogModal');
                         setTimeout(showUserList, 1000);

                  },error:function(){
                	  $("#resText").text("出错了，请重试!");
	                	Modal.show('_ocDialogModal');
                  }
           };
           $("#profileForm").ajaxSubmit(option);
            
           
        }          
                   
    });
   var validatorInit = function() {
        $("#profileForm").bootstrapValidator({
                live: 'enabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                submitButtons: '#modify',
                //指定提交按钮，如果验证失败则变成disabled
                message: '操作失败',//通用的验证失败消息
                feedbackIcons: {//根据验证结果显示的各种图标
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    nickname: {
                            validators: {
                            //notEmpty: {//检测非空,radio也可用
                              //  message: '昵称必须输入'
                            //}, 
                            stringLength: {//检测长度
                                max:10,
                                message: '长度过长'
                            }
                        }
                    },
                    phoneone:{
                         validators: {
                         stringLength: {
                         min: 11,
                         max: 11,
                         message: '请输入11位手机号码'
                     },
                         regexp:{
                            regexp:/^[0-9]/,
                            message:'仅能输入数字'
                         }
                    }
                    },
                    worknumber:{
                    	validators: {
                                notEmpty: {//检测非空,radio也可用
                                message: '工号必须输入'
                            }, 
                            stringLength: {//检测长度
                                min:6,
                            	max:15,
                                message: '长度6-15位'
                            }
                    }
                    },
                    phonetwo:{
                         validators: {
                         stringLength: {
                         min: 11,
                         max: 11,
                         message: '请输入11位号码'
                     },
                         regexp:{
                            regexp:/^[0-9]/,
                            message:'仅能输入数字'
                         }
                    }
                    },
                     description:{
                         validators: {
                         stringLength: {
                         max:45,
                         message: '描述长度限制'}
                     }},
                    }
                });
        }
   

     $(function () {
            var onValidatorInit = new validatorInit();
            // $("#modify").click(function () {//非submit按钮点击后进行验证，如果是submit则无需此句直接验证
            //     $("#form-test").bootstrapValidator('validate');//提交验证
            //     if ($("#form-test").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
            //         alert("yes");//验证成功后的操作，如ajax
            //     }
            // });
        });
   
    $("#file").change(function(){     //头像部分 
      // getObjectURL是自定义的函数，见下面  
      // this.files[0]代表的是选择的文件资源的第一个，因为上面写了 multiple="multiple" 就表示上传文件可能不止一个  
      // ，但是这里只读取第一个   
      var objUrl = getObjectURL(this.files[0]) ;  
     // console.log("objUrl = "+objUrl) ;  
      if (objUrl) {  
        // 在这里修改图片的地址属性  
        $("#image").attr("src", objUrl) ;  
      }  
    }) ;  

    //建立一個可存取到該file的url  
    function getObjectURL(file) {  
      var url = null ;   
      // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已  
      if (window.createObjectURL!=undefined) { // basic  
        url = window.createObjectURL(file) ;  
      } else if (window.URL!=undefined) { // mozilla(firefox)  
        url = window.URL.createObjectURL(file) ;  
      } else if (window.webkitURL!=undefined) { // webkit or chrome  
        url = window.webkitURL.createObjectURL(file) ;  
      }  
      return url ;  
    }  

    $("#restart").click(function () {            //重置表单
      $("#profileForm").data('bootstrapValidator').destroy();
           $("#profileForm").data('bootstrapValidator',null);
            var onValidatorInit = new validatorInit();      
    }); 
	     
</script>
</body>
</html>
